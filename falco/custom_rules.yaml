# ================================
# Falco Minimal Rules
# ================================

# --- Rules ---

# 1. Shell spawned in container (containers shouldn't need interactive shells)
- rule: Shell in container
  desc: Interactive shell spawned in running container
  condition: >
    evt.type = execve and 
    container.id != host and
    proc.name in (bash, sh, dash, zsh)
  output: >
    Shell in container (container=%container.name image=%container.image.repository 
    user=%user.name cmd=%proc.cmdline)
  priority: WARNING


# 2. Credential file access
- rule: Password file access
  desc: Direct access to system credential files
  condition: >
    evt.type in (open, openat) and
    fd.name in (/etc/shadow, /etc/sudoers) and
    evt.is_open_write=true
  output: >
    Credential file modified (file=%fd.name proc=%proc.name user=%user.name cmd=%proc.cmdline)
  priority: CRITICAL

# 3. Reverse shell indicators
- rule: Reverse shell detected
  desc: Common reverse shell patterns
  condition: >
    evt.type = execve and
    (proc.cmdline contains "sh -i" or
     proc.cmdline contains "bash -i" or
     proc.cmdline contains "/dev/tcp/" or
     proc.cmdline contains "nc -e" or
     proc.cmdline contains "ncat -e")
  output: >
    Reverse shell detected (cmd=%proc.cmdline user=%user.name container=%container.name)
  priority: CRITICAL